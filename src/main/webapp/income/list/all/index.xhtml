<?xml version='1.0' encoding='UTF-8' ?>
<ui:composition  xmlns="http://www.w3.org/1999/xhtml"
                 xmlns:h="http://java.sun.com/jsf/html"
                 xmlns:p="http://primefaces.org/ui"
                 xmlns:ui="http://java.sun.com/jsf/facelets"
                 xmlns:f="http://java.sun.com/jsf/core">

    <p:outputPanel styleClass="block">
        <h:form id="topicIncomeForm" prependId="false">
            <div class="operation-header"> 
                <div class="operation-header-left">
                    <h:outputText value="ตั้งแต่ : "/>
                    <p:inputText id="startDate" 
                                 value="#{incomeItemCtrl.startDate}" 
                                 styleClass="ic-calendar">
                        <f:convertDateTime pattern="#{localeCtrl.calendarFormat}"/>
                    </p:inputText>
                    <p:watermark for="startDate" value="วันที่"/>
                    <h:outputText value=" ถึง : "/>
                    <p:inputText id="endDate" 
                                 value="#{incomeItemCtrl.endDate}" 
                                 styleClass="ic-calendar">
                        <f:convertDateTime pattern="#{localeCtrl.calendarFormat}"/>
                    </p:inputText>
                    <p:watermark for="endDate" value="วันที่"/>
                    <p:spacer width="10"/>
                    <p:commandButton value="ค้นหา"
                                     icon="ui-icon-search"
                                     update="@(.block-body), @(.item-list)"
                                     actionListener="#{incomeItemCtrl.onSeach()}"
                                     styleClass="white-button"/>
                    <p:spacer width="5"/>
                    <p:commandButton icon="ui-icon-refresh"
                                     title="เคลียร์ผลลัพธ์"
                                     update="@(.block-body), @(.item-list), @form"
                                     actionListener="#{incomeItemCtrl.onClear()}"
                                     styleClass="tooltip-w white-button"/>
                </div>
                <div class="operation-header-right">
                    <p:commandButton value="เพิ่มรายการ"
                                     actionListener="#{incomeItemCtrl.onCreateItem()}"
                                     update=":addIncomeItemDialogForm"
                                     styleClass="green-button"
                                     oncomplete="PF('addIncomeItemWidgetDialog').show();"
                                     icon="ui-icon-plus"/>
                </div>
            </div>
        </h:form>
        <p:dataTable value="#{incomeItemCtrl.lazy}"
                     var="item"
                     rows="15"
                     styleClass="item-list"
                     lazy="true"
                     sortBy="#{item.incomeDate}"
                     sortOrder="DESCENDING"
                     rowIndexVar="counter"
                     paginator="true"
                     emptyMessage="ยังไม่มีข้อมูล"
                     paginatorPosition="bottom"
                     paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                     rowsPerPageTemplate="5,10,15,25,50">
            <p:column headerText="ที่" style="width: 5%">
                <h:outputText value="#{counter + 1}"/>
            </p:column>
            <p:column headerText="รายการ">
                <h:outputText value="#{item.incomeName}"/>
            </p:column>
            <p:column headerText="จำนวนเงิน" styleClass="number">
                <h:outputText value="#{numerFormat.format(item.incomeValue)}" styleClass="green-text"/>
            </p:column>
            <p:column headerText="วัน/เวลา">
                <h:outputText value="#{item.incomeDate}">
                    <f:convertDateTime pattern="#{localeCtrl.calendarFormat}"/>
                </h:outputText>
                <p:spacer width="5"/>
                <h:outputText value="#{item.incomeTime}">
                    <f:convertDateTime pattern="HH:mm"/>
                </h:outputText>
            </p:column>
            <p:column headerText="ป้ายกำกับ">
                <h:outputText value="#{item.tagsString}" styleClass="#{item.tags.isEmpty() ? 'gray-text' : 'green-text'}"/>
            </p:column>
            <p:column headerText="#" style="width: 60px">
                <p:commandLink value="แก้ไข"
                               update=":editIncomeItemDialogForm"
                               oncomplete="PF('editIncomeItemWidgetDialog').show()"
                               actionListener="#{incomeItemCtrl.onSelectItem()}">
                    <f:param name="itemId" value="#{item.id}"/>
                </p:commandLink>
                <p:spacer width="5"/>
                <p:commandLink value="ลบ"
                               update=":deleteIncomeItemDialogForm"
                               oncomplete="PF('deleteIncomeItemWidgetDialog').show()"
                               actionListener="#{incomeItemCtrl.onSelectItem()}">
                    <f:param name="itemId" value="#{item.id}"/>
                </p:commandLink>
            </p:column>
        </p:dataTable>
    </p:outputPanel>
    <p:outputPanel styleClass="block">
        <h3 class="block-header">สรุปทั้งหมด</h3>
        <p:outputPanel styleClass="block-body">
            <h:panelGrid class="form-grid"
                         columns="2">
                <p:outputPanel>
                    รายรับทั้งหมด <br/> (ยังไม่หักรายจ่าย)
                </p:outputPanel>
                <p:outputPanel>
                    <h:outputText value="#{numerFormat.format(summaryIncomeCtrl.summary)}" styleClass="green-text"/>
                </p:outputPanel>
                <p:outputPanel>
                    จำนวน 
                </p:outputPanel>
                <p:outputPanel>
                    <h:outputText value="#{summaryIncomeCtrl.totalItems}" styleClass="green-text"/>
                    <p:spacer width="10"/>
                    <h:outputText value="รายการ"/>
                </p:outputPanel>
                <p:outputPanel>
                    ตั้งแต่วันที่
                </p:outputPanel>
                <p:outputPanel>
                    <h:outputText value="#{summaryIncomeCtrl.startDate}" styleClass="green-text">
                        <f:convertDateTime pattern="#{localeCtrl.calendarFormat}"/>
                    </h:outputText>
                </p:outputPanel>
                <p:outputPanel>
                    ถึงวันที่
                </p:outputPanel>
                <p:outputPanel>
                    <h:outputText value="#{summaryIncomeCtrl.endDate}" styleClass="green-text">
                        <f:convertDateTime pattern="#{localeCtrl.calendarFormat}"/>
                    </h:outputText>
                </p:outputPanel>
            </h:panelGrid>  
        </p:outputPanel>
    </p:outputPanel>
    <p:outputPanel styleClass="block">
        <h3 class="block-header">สถิติทั้งหมด</h3>
        <p:outputPanel styleClass="block-body">
            <div>มองทีละรายการ</div>
            <h:panelGrid class="form-grid"
                         columns="4">
                <p:outputPanel>
                    รายรับสูงสุด &#8593;
                </p:outputPanel>
                <p:outputPanel>
                    <h:outputText value="#{statisticCtrl.maxItem.key}" styleClass="green-text"/>
                </p:outputPanel>
                <p:outputPanel>
                    เป็นจำนวนเงิน
                </p:outputPanel>
                <p:outputPanel>
                    <h:outputText value="#{numerFormat.format(statisticCtrl.maxItem.value)}" styleClass="green-text"/>
                </p:outputPanel>
                <p:outputPanel>
                    รายรับต่ำสุด &#8595;
                </p:outputPanel>
                <p:outputPanel>
                    <h:outputText value="#{statisticCtrl.minItem.key}" styleClass="green-text"/>
                </p:outputPanel>
                <p:outputPanel>
                    เป็นจำนวนเงิน
                </p:outputPanel>
                <p:outputPanel>
                    <h:outputText value="#{numerFormat.format(statisticCtrl.minItem.value)}" styleClass="green-text"/>
                </p:outputPanel>
            </h:panelGrid>  
            <div>มองตามชื่อ <span class="gray-text">(หมายถึง group ตามชื่อ)</span></div>
            <h:panelGrid class="form-grid"
                         columns="4">
                <p:outputPanel>
                    รายรับสูงสุด &#8593;
                </p:outputPanel>
                <p:outputPanel>
                    <h:outputText value="#{statisticCtrl.maxItemGroup.key}" styleClass="green-text"/>
                </p:outputPanel>
                <p:outputPanel>
                    เป็นจำนวนเงิน
                </p:outputPanel>
                <p:outputPanel>
                    <h:outputText value="#{numerFormat.format(statisticCtrl.maxItemGroup.value)}" styleClass="green-text"/>
                </p:outputPanel>
                <p:outputPanel>
                    รายรับต่ำสุด &#8595;
                </p:outputPanel>
                <p:outputPanel>
                    <h:outputText value="#{statisticCtrl.minItemGroup.key}" styleClass="green-text"/>
                </p:outputPanel>
                <p:outputPanel>
                    เป็นจำนวนเงิน
                </p:outputPanel>
                <p:outputPanel>
                    <h:outputText value="#{numerFormat.format(statisticCtrl.minItemGroup.value)}" styleClass="green-text"/>
                </p:outputPanel>
            </h:panelGrid>
            <div>มองตามป้ายกำกับ <span class="gray-text">(หมายถึง group ตามป้ายกำกับ)</span></div>
            <h:panelGrid class="form-grid"
                         columns="4">
                <p:outputPanel>
                    รายรับสูงสุด &#8593;
                </p:outputPanel>
                <p:outputPanel>
                    <h:outputText value="#{statisticCtrl.maxItemTag.key}" styleClass="green-text"/>
                </p:outputPanel>
                <p:outputPanel>
                    เป็นจำนวนเงิน
                </p:outputPanel>
                <p:outputPanel>
                    <h:outputText value="#{numerFormat.format(statisticCtrl.maxItemTag.value)}" styleClass="green-text"/>
                </p:outputPanel>
                <p:outputPanel>
                    รายรับต่ำสุด &#8595;
                </p:outputPanel>
                <p:outputPanel>
                    <h:outputText value="#{statisticCtrl.minItemTag.key}" styleClass="green-text"/>
                </p:outputPanel>
                <p:outputPanel>
                    เป็นจำนวนเงิน
                </p:outputPanel>
                <p:outputPanel>
                    <h:outputText value="#{numerFormat.format(statisticCtrl.minItemTag.value)}" styleClass="green-text"/>
                </p:outputPanel>
            </h:panelGrid>
        </p:outputPanel>
    </p:outputPanel>
</ui:composition>